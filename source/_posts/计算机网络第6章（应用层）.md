---
title: 计算机网络第6章（应用层）
categories:
 - [八股,计算机网络,基础]
date: 2022-12-30 18:30:00
tag: 
 - 计算机网络
 - 八股
---

# 一、概述
![](24878825-968c1bcea54ea1f4.webp)
例子：
**万维网WWW应用**，其相关的应用层协议为**超文本传送协议HTTP**，该应用还涉及到域名到IP地址的转换，由属于**应用层范畴的域名系统DNS**完成。
![](24878825-4e9858624d4835ae.webp)
![](24878825-c1c3868fb5e127b1.webp)

# 二、两种组织方式
## 客户/服务器方式（C/S方式）
![](24878825-bbfb139bb8ffd796.webp)
## 对等方式（P2P方式）
![](24878825-598b1158f5c33a11.webp)
{% note primary %}
www,email,ftp为C/S架构。
{% endnote %}

# 三、动态主机配置协议DHCP
## 概念
互联网广泛使用的**动态主机配置协议 DHCP** (Dynamic Host Configuration Protocol) 提供了**即插即用连网** (plug-and-play networking) 的机制。这种机制允许一台计算机加入新的网络和获取 IP 地址，而不用手工配置。

## 工作过程
### 概念
**DHCP**使用了C/S方式：
- 主机在启动时向DHCP服务器广播发送发现报文 （DHCP DISCOVER），这时该主机就成为 DHCP 客户。
- 本地网络上所有主机都能收到此广播报文，但只有 DHCP 服务器才回答此广播报文。
- DHCP 服务器先在其数据库中查找该计算机的配置信息。若找到，则返回找到的信息。若找不到，则从服务器的 IP 地址池 (address pool) 中取一个地址分配给该计算机。DHCP服务器的回答报文叫做提供报文（DHCP OFFER）。
- 基于UDP工作，DHCP 服务器运行在 67 号端口， DHCP客户运行在 68 号端口。

### 交互过程
#### 发现报文
**DHCP客户端将广播发送DHCP发现报文（DHCP DISCOVER）**，其中包含**事务ID**，**DHCP客户端的MAC地址**

![](24878825-6f9a9715f8b1c74a.webp)

>报文包括：
>- **源IP地址**：0.0.0.0，这是因为主机目前还未分配到IP地址。
>- **目的地址**：广播地址255.255.255.255。
>- **MAC地址**：主机MAC地址。

DHCP服务器收到DHCP发现报文后，根据其中封装的DHCP客户端的MAC地址来查找自己的数据库，如果查到匹配信息，则使用这些配置信息来构建并发送DHCP提供报文，如果没有则采用默认配置信息来构建报文并发送。

#### 提供报文
**DHCP服务端将广播发送DHCP提供报文（DHCP OFFER）**

![](24878825-03ecd6d2838d4274.webp)

>报文包括
>- **事务ID**：DHCP客户端会与之前DHCP发现报文的事务ID做对比，来判断该DHCP提供报文是否是自己的。
>- **配置信息**：IP地址、子网掩码、地址租期、默认网关、DNS服务器
>- **源IP地址**：发送DHCP提供报文的DHCP服务器的IP
>- **目的地址**：因为目的主机还没分配到IP，所以使用广播地址

在本例中，DHCP客户会收到两个DHCP服务器发来的DHCP提供报文，DHCP客户从中选择一个，一般选择先到的，并向所选择的DHCP服务器发送DHCP请求报文。

#### 请求报文
**DHCP客户端将广播发送DHCP请求报文（DHCP REQUEST）**
![](24878825-009b1e9a88976880.webp)

>报文包括
>**事务ID**
>**MAC地址**
>**接受的IP地址**
>**提供此租约的DHCP服务器端的IP地址**
>**源IP地址**：0.0.0.0
>**目的地址**：广播地址，这样可以一次性向所有DHCP服务器发送DHCP请求报文，来告知它们作为自己的DHCP服务器。

在本例中，假设DHCP客户端选择DHCP服务器1作为自己的DHCP服务器，DHCP服务器1接受该请求，于是DHCP服务器1给DHCP客户端发送DHCP确认报文。

#### 确认报文
**DHCP服务端将广播发送DHCP确认报文（DHCP ACK）**
![](24878825-35c9002bba766476.webp)
>报文包括：
>源地址：DHCP服务器1的IP地址
>目的地址：广播地址

**DHCP客户收到该报文后就可以使用租用的IP地址**，**在使用前还会进行ARP检测**。
![](24878825-044fb99d76bd279c.webp)
#### 剩余流程
![](24878825-a01eacfba40e9098.webp)

{% note primary %}
由于确认客户端的IP地址前，其都没有IP地址，所以DHCP借用IP的过程中报文的目的IP都是广播，服务器的源IP地址都是自身IP地址，客户端IP地址为默认0.0.0.0。

客户端请求IP是一个4握手过程。前2个握手用于服务端和客户端明确对方的存在并给客户端一个Offer。后2个握手就是客户端确定这个Offer的过程。

第三个握手，虽然是广播，但其他的DHCP服务器是不会接受的，因为事物ID不符。

到达0.5倍租用期时，客户端会主动续租，若超过了租用期，则停止使用这个IP地址。
{% endnote %}

## DHCP中继代理
![](24878825-33c64efac75f0ad2.webp)

由于网络之间存在广播域，主机的广播消息可能无法送达DHCP服务器，可为路由器配置DHCP中继代理服务，路由器会将接受到的DHCP报文转发到DHCP服务器。

>使用DHCP中继代理是因为我们不用给每一个网络上都设置一个DHCP服务器，这样会使DHCP服务器的数量太多

## 总结
![](24878825-37d8836f5ed85036.webp)

# 四、域名系统DNS
## 概述
![](24878825-8dc45fb61122f775.webp)
![](24878825-31a3076fe8055379.webp)
![](24878825-4655232a57435f63.webp)

>名称相同的域名等级未必相同。

![](24878825-c2350ce866abf74e.webp)

## 域名解析过程
![](24878825-aae45d426ec7fa49.webp)
{% note primary %}
递归查询的过程是链式调用，最后将域名对应的IP地址返回给主机。
迭代查询的过程是由本地域名服务器作为请求主体，迭代查询各级服务器IP。
{% endnote %}

### 缓存
![](24878825-d2652511b6f2280d.webp)
{% note primary %}
本地域名服务器使用高速缓存减少DNS查询次数，但需要保证正确性，所以对于每一项缓存都有倒计时，超时的记录会被删除。
同时，主机也需要做缓存（多级缓存），启动时便向本地域名服务器获取域名和IP的数据库信息，必要时再询问服务器。
{% endnote %}

## 总结
![](24878825-93d3fbaa54195112.webp)

# 五、文件传送协议FTP
## 概念
![](24878825-df91fe396712c633.webp)

## 工作过程
FTP采用了C/S方式，监听熟知端口（21）。
### 主动模式与被动模式
![](24878825-885981a43745ae55.webp)
{% note primary %}
主动、被动指的是数据通道的建立发起者是否是服务器，主动模式服务器会使用固定的端口号连接客户端的临时端口号，被动模式服务器会开启某个临时端口号等待客户端连接。
注意，两种方式最后都会建立两个连接通道，控制连接在整个会话期间保持打开状态，数据连接传输完毕后就关闭。
{% endnote %}

## 总结
![](Pasted-image-20221230015319.png)

# 六、电子邮件
## 概念
![](24878825-905f080fde0331a5.webp)

>注意：SMTP是发送协议，POP3/IMAP是读取协议。

## 邮件发送和接受过程
![](24878825-a55537e03d980133.webp)
 ### 简单邮件传送协议SMTP（*Simple Mail Transfer Protocol*）
![](24878825-03f4877d2621c261.webp)
### 电子邮件格式
![](24878825-fb16b5ace5466b25.webp)
{% note primary %}
**MIME**是一层非ASCII和ASCII码之间的扩展转换器，其可以协助非ASCII码邮件以SMTP的形式发送。
{% endnote %}

### 邮件接受
![](24878825-c825d1ad122bd41c.webp)
>**POP3**是正式标准，客户只读。
>**IMAP4**是建议标准，客户可以操作服务器中的邮件，需要联机。

### 基于万维网的电子邮件
![](24878825-46b15b10a17604fa.webp)

## 总结
![](24878825-b400e3f6c0a87238.webp)

{% note primary %}
POP3使用110端口，IMAP4使用143端口
{% endnote %}

# 七、万维网WWW
## 概念
基本概念
- **万维网** WWW (World Wide Web) 并非某种特殊的计算机网络，而是一个大规模的、联机式的**信息储藏所**。
- 万维网以**客户 - 服务器**方式工作。**浏览器**就是在用户计算机上的万维网**客户程序**。万维网文档所驻留的计算机则运行**服务器程序**，因此这个计算机也称为**万维网服务器**。
- 客户程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的**万维网文档**。在一个客户程序主窗口上显示出的万维网文档称为**页面** (page)。

![](24878825-8646898df7461ca3.webp)
![](24878825-05ae15f55de2ba0a.webp)

## HTTP（*Hyper Transfer Protocol*）
### 概念
- 在万维网客户程序与万维网服务器程序之间进行交互所使用的协议，是**超文本传送协议** HTTP (HyperText Transfer Protocol)。
- HTTP是一个应用层协议，它使用 **TCP 连接**进行可靠的传送。
- 每个万维网网点都有一个服务器进程，它不断地**监听 TCP 的端口 80**，以便发现是否有浏览器向它发出连接建立请求。
![](24878825-614d1960b2b805d9.webp)

{% note primary %}
可以注意到第三次握手的时候就发出了HTTP请求报文。
{% endnote %}

### 报文格式
请求报文
![](24878825-22dfb8a34acf459c.webp)
响应报文
![](24878825-0409ca153701fbb4.webp)

### 使用Cookie在服务器上记录用户信息
![](24878825-969dc15b42399e98.webp)

### 万维网缓存与代理服务器
![](24878825-abf0fcf785757c26.webp)
![](24878825-e7f4b696946ffafa.webp)
![](24878825-14ec3f45c4af32f9.webp)

{% note primary %}
为了保证缓存的正确性，设置有过期时间，若没有过期，则直接返回，若过期了，则询问服务器文档内容是否有变化：
- 若没有则直接返回一个普通响应，缓存服务器接受后直接刷新倒计时。
- 若有则返回新的文档内容，缓存服务器接收并更新内容。
{% endnote %}

## 总结
![](24878825-dab94fae0e969502.webp)