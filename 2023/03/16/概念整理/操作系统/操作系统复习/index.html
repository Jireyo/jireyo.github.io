

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#727679">
  <meta name="author" content="Jin">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、硬件结构硬件组成图灵机栈式读取操作数和操作指令并执行 冯诺依曼模型组成：运算器、控制器、存储器、输入设备、输出设备。 内存以字节byte为单位的存储空间，从0开始编号。 CPU包括控制单元、寄存器（包括通用寄存器、程序计数器、指令寄存器）、逻辑运算单元。32位CPU一次计算4字节，64位CPU一次计算8字节，对于小数字而言，64位和32位的运算速度接近。 总线当 CPU 要读写内存数据的时候，">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统复习">
<meta property="og:url" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/index.html">
<meta property="og:site_name" content="Jin&#39;s Blog">
<meta property="og:description" content="一、硬件结构硬件组成图灵机栈式读取操作数和操作指令并执行 冯诺依曼模型组成：运算器、控制器、存储器、输入设备、输出设备。 内存以字节byte为单位的存储空间，从0开始编号。 CPU包括控制单元、寄存器（包括通用寄存器、程序计数器、指令寄存器）、逻辑运算单元。32位CPU一次计算4字节，64位CPU一次计算8字节，对于小数字而言，64位和32位的运算速度接近。 总线当 CPU 要读写内存数据的时候，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E6%A8%A1%E5%9E%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/CPU%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/CPU-Cache.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E5%85%B3%E7%B3%BB%E5%9B%BE.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%B1%82%E6%A8%A1%E6%98%A0%E5%B0%84%E7%AD%96%E7%95%A5.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%9B%B4%E6%8E%A5Cache%E6%98%A0%E5%B0%84.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/float.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6-C-SCAN%E7%AE%97%E6%B3%95.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Kernel_Layout.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/systemcall.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/72ab76ba697e470b8ceb14d5fc5688d9.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/a9ed979e2ed8414f9828767592aadc21.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/7884f4d8db4949f7a5bb4bbd0f452609.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%BC%BA%E9%A1%B5%E5%BC%82%E5%B8%B8%E6%B5%81%E7%A8%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/19296e249b2240c29f9c52be70f611d5.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%9B%9B%E7%BA%A7%E5%88%86%E9%A1%B5.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/a3cdf27646b24614a64cfc5d7ccffa35.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/8904fb89ae0c49c4b0f2f7b5a0a7b099.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/bc0aaaf379fc4bc8882efd94b9052b64.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/3a6cb4e3f27241d3b09b4766bb0b1124-20230309234553726.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/48403193b7354e618bf336892886bcff.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/32%E4%BD%8D%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/cb6e3ce4532ff0a6bfd60fe3e52a806e.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/75edee0cb75450e7987a8a482b975bda.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/2f61b0822b3c4a359f99770231981b07.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/166bc9f5b7c545d89f1e36ab8dd772cf.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%A1%B5%E8%A1%A8%E9%A1%B9%E5%AD%97%E6%AE%B5.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%97%B6%E9%92%9F%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/10-%E8%BF%9B%E7%A8%8B%E4%B8%83%E4%B8%AD%E7%8A%B6%E6%80%81.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/12-PCB%E7%8A%B6%E6%80%81%E9%93%BE%E8%A1%A8%E7%BB%84%E7%BB%87.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/26-%E5%93%8D%E5%BA%94%E6%AF%94%E5%85%AC%E5%BC%8F.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/28-%E5%A4%9A%E7%BA%A7%E9%98%9F%E5%88%97.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%BB%BB%E5%8A%A1.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%B0%83%E5%BA%A6%E7%B1%BB.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/CPU%E9%98%9F%E5%88%97.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%BC%98%E5%85%88%E7%BA%A7.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/8-%E7%AE%A1%E9%81%93-pipe-shell.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/9-%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/23-%E5%93%B2%E5%AD%A6%E5%AE%B6%E8%BF%9B%E9%A4%90%E6%A8%A1%E5%9E%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A1%AC%E9%93%BE%E6%8E%A5-2.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%BD%AF%E9%93%BE%E6%8E%A5.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%9B%AE%E5%BD%95%E9%A1%B9%E5%92%8C%E7%B4%A2%E5%BC%95%E5%85%B3%E7%B3%BB%E5%9B%BE.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E5%AD%98%E6%94%BE%E6%96%B9%E5%BC%8F.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%9D%9E%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E5%AD%98%E6%94%BE%E6%96%B9%E5%BC%8F-%E9%93%BE%E8%A1%A8%E6%96%B9%E5%BC%8F.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%96%87%E4%BB%B6%E5%88%86%E9%85%8D%E8%A1%A8.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%9D%9E%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E5%AD%98%E6%94%BE%E6%96%B9%E5%BC%8F-%E7%B4%A2%E5%BC%95%E6%96%B9%E5%BC%8F.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%93%BE%E5%BC%8F%E7%B4%A2%E5%BC%95%E5%9D%97.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95%E5%9D%97.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F%E6%AF%94%E8%BE%83.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Unix-%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A9%BA%E9%97%B2%E8%A1%A8%E6%B3%95.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A9%BA%E9%97%B2%E5%9D%97%E9%93%BE%E8%A1%A8.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%9D%97%E7%BB%84.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/72568a29816fa9b505f15edac68adee2.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/ae8252378169c8c14b8b9907983f7d8b-20230309235145646.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230409194607.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%B8%AD%E6%96%AD%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/I_O%E8%BD%AF%E4%BB%B6%E5%88%86%E5%B1%82.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/DRM-I_O-%E8%BF%87%E7%A8%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%BC%A0%E7%BB%9F%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93.webp">
<meta property="og:image" content="http://example.com/mmap%20+%20write%20%E9%9B%B6%E6%8B%B7%E8%B4%9D.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/senfile-3%E6%AC%A1%E6%8B%B7%E8%B4%9D.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/senfile-%E9%9B%B6%E6%8B%B7%E8%B4%9D.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213143753.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213143817.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150145.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150246.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150315.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150509.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230405144258.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230405144507.png">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/epoll.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%8D%95Reactor%E5%8D%95%E8%BF%9B%E7%A8%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%8D%95Reactor%E5%A4%9A%E7%BA%BF%E7%A8%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%B8%BB%E4%BB%8EReactor%E5%A4%9A%E7%BA%BF%E7%A8%8B.webp">
<meta property="og:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Proactor.webp">
<meta property="article:published_time" content="2023-03-16T14:46:30.000Z">
<meta property="article:modified_time" content="2023-06-18T07:04:00.597Z">
<meta property="article:author" content="Jin">
<meta property="article:tag" content="操作系统">
<meta property="article:tag" content="概念整理">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E6%A8%A1%E5%9E%8B.webp">
  
  
  
  <title>操作系统复习 - Jin&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/fluid-extention.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong style="color: #fff;">Jin&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                文章
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                归档
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    <i class="iconfont icon-category-fill"></i>
                    分类
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    <i class="iconfont icon-tags-fill"></i>
                    标签
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="操作系统复习"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-16 22:46" pubdate>
          2023年3月16日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          14k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          115 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">操作系统复习</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一、硬件结构"><a href="#一、硬件结构" class="headerlink" title="一、硬件结构"></a>一、硬件结构</h1><h2 id="硬件组成"><a href="#硬件组成" class="headerlink" title="硬件组成"></a>硬件组成</h2><p><em>图灵机</em><br>栈式读取操作数和操作指令并执行</p>
<p><em>冯诺依曼模型</em><br>组成：<strong>运算器、控制器、存储器、输入设备、输出设备</strong>。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E6%A8%A1%E5%9E%8B.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>内存</em><br>以字节byte为单位的存储空间，从0开始编号。</p>
<p><em>CPU</em><br>包括控制单元、寄存器（包括通用寄存器、程序计数器、指令寄存器）、逻辑运算单元。32位CPU一次计算4字节，64位CPU一次计算8字节，对于小数字而言，64位和32位的运算速度接近。</p>
<p><em>总线</em><br>当 CPU 要读写内存数据的时候，一般需要通过下面这三个总线：</p>
<ul>
<li>首先要通过「地址总线」来指定内存的地址；</li>
<li>然后通过「控制总线」控制是读或写命令；</li>
<li>最后通过「数据总线」来传输数据；</li>
</ul>
<p><em>线路位宽</em></p>
<ul>
<li>地址总线的条数（线路位宽）决定了指定一个内存地址需要在地址总线上进行几次传输。</li>
<li>CPU的位宽应该不小于线路位宽，否则其无法操作所有内存。</li>
<li>32位CPU最大操作4GB内存，64位CPU最大寻址空间为<code>2^64</code>。</li>
</ul>
<p><em>程序执行过程</em></p>
<ol>
<li>程序计数器：存储了指令的内存地址（硬件位宽指CPU的位宽，软件位宽指的是指令的位宽，两者相等才能正常运作）。</li>
<li>控制单元：操作地址总线指定指令的内存地址，通过数据总线获取指令，将指令存储到指令寄存器中，程序计数器自增。</li>
<li>CPU：分析指令寄存器中指令：计算类将给逻辑运算单元处理；读写类交给控制单元处理。</li>
</ol>
<p><em>指令周期</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/CPU%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F.webp" srcset="/img/loading.gif" lazyload><br>获取指令-&gt;指令译码(控制单元完成)-&gt;执行指令(算数逻辑单元完成)-&gt;数据回写</p>
<p><em>指令执行速度</em><br>时钟周期是CPU执行时间的基本单位，执行时间：<br><code>CPU执行时间 = 指令数 * CPI(平均每个指令的周期数) * 时钟周期</code></p>
<h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><p><em>结构</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/CPU-Cache.webp" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E5%85%B3%E7%B3%BB%E5%9B%BE.webp" srcset="/img/loading.gif" lazyload><br>访问内存数据时，逐层查看是否有缓存。</p>
<p><em>内存</em><br>DRAM （_Dynamic Random Access Memory_，动态随机存取存储器），基于电容，需要不断刷新才能存储数据。</p>
<p><em>SSD&#x2F;HDD硬盘</em></p>
<ul>
<li>SSD固体硬盘，结构与内存类似，比HDD快。</li>
<li>HHD机械硬盘，传统结构，速度很慢。</li>
</ul>
<h3 id="CPU-Cache"><a href="#CPU-Cache" class="headerlink" title="CPU Cache"></a>CPU Cache</h3><p>CPU Cache是内存体系中的组成部分，但硬件上属于CPU。<br><em>Cache与内存的映射</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%B1%82%E6%A8%A1%E6%98%A0%E5%B0%84%E7%AD%96%E7%95%A5.webp" srcset="/img/loading.gif" lazyload><br>内存块(Block)会按照地址求模映射到Cache Line上。</p>
<p><em>结构</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%9B%B4%E6%8E%A5Cache%E6%98%A0%E5%B0%84.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>有效位：本记录是否有效；</li>
<li>组标记：记录本CacheLine当前记录的Block；</li>
<li>实际数据：内存块的数据缓存。</li>
</ul>
<blockquote>
<p>CPU读取数据时，需要以块为单位将内存加载到缓存，但不需要读取整个块，所以还会指定偏移量。</p>
</blockquote>
<p><em>如何提高CPU速度？</em></p>
<ul>
<li>提高数据缓存命中率：尽量访问连续内存，如顺序访问数组。</li>
<li>提高指令缓存命中率：CPU有分支预测器，如果某条件判断的跳转大概率成立，则会缓存跳转后的相关指令。</li>
<li>提高多核CPU命中率：一个用户线程绑定在一个CPU核心上，防止切换CPU对缓存命中率的影响。</li>
</ul>
<h4 id="CPU-Cache一致性"><a href="#CPU-Cache一致性" class="headerlink" title="CPU Cache一致性"></a>CPU Cache一致性</h4><p><em>两种同步方案</em></p>
<ul>
<li>写直达(Write Through)：把数据同时写入内存和 Cache 中</li>
<li>写回(Write Back)：只把数据写入Cache Block中（标记为脏块），当其被替换时，才写回内存。</li>
</ul>
<p><em>缓存一致性问题</em><br>CPU的不同核心同时对相同的内存块进行操作。</p>
<p><em>需要解决的问题</em><br>要解决缓存一致性，需要解决两个问题：</p>
<ul>
<li>写传播（可见性）：某CPU写内存后对其他CPU可见。</li>
<li>事物串行化（有序性）：其他CPU收到的写传播顺序与原CPU写入顺序一致。</li>
</ul>
<p><em>总线嗅探</em><br>某CPU修改内存数据后，通过总线广播到其他CPU，实现了<strong>写传播</strong>。</p>
<p><em>MESI协议</em><br>概念：Cache Line具有4种状态（Modified、Exclusive、Shared、Invalidated）。<br>工作原理：</p>
<ul>
<li>某CPU核心读取内存后为Cache Line独占模式</li>
<li>此时其他CPU也读取相同内存，对应得Cache Line都变成共享模式。</li>
<li>某CPU要对共享模式的Cache Line写入时，将其他CPU的Cache Line标记为无效，然后再更新。</li>
</ul>
<p><em>伪共享问题</em></p>
<ul>
<li>定义：由于Cache是以块为单位读取的，会出现两个线程操作同一个块中不同的变量却导致彼此反复失效的情况，严重消耗性能。</li>
<li>解决：为变量后面填充空白，使2个相邻变量其在内存中位于不同的Block。</li>
</ul>
<h2 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h2><p><em>十进制与二进制</em><br>十进制转二进制：小数使用乘2取整法，可能会产生无限循环的二进制表达，但计算机位数有限，造成了精度损失。</p>
<p><em>浮点数的存储</em><br>默认整数部分为1，且省略。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/float.webp" srcset="/img/loading.gif" lazyload></p>
<h2 id="磁盘调度"><a href="#磁盘调度" class="headerlink" title="磁盘调度"></a>磁盘调度</h2><p>磁盘调度算法：</p>
<ul>
<li>先来先服务：寻找最早请求的扫描点，效率低下；</li>
<li>最短寻道时间优先算法：寻找距离当前磁头最近的扫描点，折返的无效路径较多；</li>
<li>扫描算法：往一个方向访问完到终点后转头，效率高，但中间部分扫描频率更高；</li>
<li>循环扫描算法：总是从同一个方向开始扫描，解决扫描算法响应频率不均匀的问题，但效率会低一些；</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6-C-SCAN%E7%AE%97%E6%B3%95.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>LOOK与C-LOOK算法：优化了扫描和循环扫描算法，即不需要扫描到终点，只扫描到最远处的请求即转向。</li>
</ul>
<h1 id="二、操作系统结构"><a href="#二、操作系统结构" class="headerlink" title="二、操作系统结构"></a>二、操作系统结构</h1><p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Kernel_Layout.webp" srcset="/img/loading.gif" lazyload><br>操作系统内核是应用连接硬件设备的桥梁。</p>
<p><em>内存空间</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/systemcall.webp" srcset="/img/loading.gif" lazyload><br>操作系统将内存分为了用户空间和系统空间，当程序使用用户空间时，称程序在<strong>用户态</strong>执行，当程序使用内核空间时，程序在<strong>内核态</strong>执行。</p>
<p><em>Linux 内核设计的理念</em></p>
<ul>
<li>MultiTask，多任务。支持并发、并行。</li>
<li>SMP，对称多处理。即每个CPU地位相等。</li>
<li>ELF，可执行文件链接格式。</li>
<li>Monolithic Kernel，宏内核。即系统内核的所有模块，比如进程调度、内存管理、文件系统、设备驱动等，都运行在内核态。</li>
</ul>
<p><em>Window 内核设计的理念</em></p>
<ul>
<li>MultiTask和SMP</li>
<li>PE，可移植执行文件。</li>
<li>Mix Kernel，混合内核。即内核中有一个微内核，其他模块在这个微内核的基础上搭建，一起组成整个内核。</li>
</ul>
<h1 id="三、内存管理"><a href="#三、内存管理" class="headerlink" title="三、内存管理"></a>三、内存管理</h1><h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p><em>概念</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/72ab76ba697e470b8ceb14d5fc5688d9.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>程序所使用的内存地址叫做虚拟内存地址</li>
<li>硬件所使用的空间地址叫做物理内存地址</li>
<li>MMU（内存管理单元负责虚拟内存地址和物理内存地址的映射）</li>
</ul>
<p><em>映射方式</em></p>
<ul>
<li>内存分段</li>
<li>内存分页</li>
</ul>
<h3 id="内存分段"><a href="#内存分段" class="headerlink" title="内存分段"></a>内存分段</h3><p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/a9ed979e2ed8414f9828767592aadc21.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>段选择因子：确定了段描述符，可以得到段的元信息。</li>
<li>段内偏移量：确定了地址在段内的偏移量</li>
</ul>
<p><em>内存分段的问题</em></p>
<ul>
<li>存在外部内存碎片：<ul>
<li>分段做到了按需求分配内存，<strong>不会出现内部内存碎片</strong>。</li>
<li>段之间<strong>存在外部内存碎片</strong>。可以使用内存交换，通过挂起后唤醒程序的方式调整。</li>
</ul>
</li>
<li>内存交换效率低：内存空间不足时，需要将段换出到硬盘上，频繁的swap会导致效率低下。</li>
</ul>
<h3 id="内存分页"><a href="#内存分页" class="headerlink" title="内存分页"></a>内存分页</h3><p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/7884f4d8db4949f7a5bb4bbd0f452609.webp" srcset="/img/loading.gif" lazyload><br>当进程访问<strong>页表</strong>中查不到的虚拟地址时，产生<strong>缺页异常</strong>，会进入物理地址分配物理内存并更新<strong>页表</strong>。</p>
<p><em>缺页异常</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%BC%BA%E9%A1%B5%E5%BC%82%E5%B8%B8%E6%B5%81%E7%A8%8B.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>内存分页的问题</em></p>
<ul>
<li>存在<strong>内部内部碎片</strong><ul>
<li>页与页之间紧密排列，<strong>不会出现外部碎片</strong>。</li>
<li>页是最小的内存分配单元，可能造成浪费，即<strong>内部内存碎片</strong>。</li>
</ul>
</li>
<li>内存交换效率高：内存空间不足时，每次只会把其他允许进程中最近没有被使用的少数内存页面换出到硬盘上。</li>
</ul>
<h4 id="多级页表"><a href="#多级页表" class="headerlink" title="多级页表"></a>多级页表</h4><p>简单分页会导致页表过于庞大。因此引入多级页表。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/19296e249b2240c29f9c52be70f611d5.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>多级页表中，一级页表映射了全部虚拟地址。</li>
<li>对于没有使用的一级页表，可以不创建其对应的二级页表，从而实现页表空间的节省。</li>
</ul>
<p><em>64位系统</em></p>
<ul>
<li>全局页目录项 PGD（Page Global Directory）；</li>
<li>上层页目录项 PUD（Page Upper Directory）；</li>
<li>中间页目录项 PMD（Page Middle Directory）；</li>
<li>页表项 PTE（Page Table Entry）；<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%9B%9B%E7%BA%A7%E5%88%86%E9%A1%B5.webp" srcset="/img/loading.gif" lazyload></li>
</ul>
<p><em>TLB</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/a3cdf27646b24614a64cfc5d7ccffa35.webp" srcset="/img/loading.gif" lazyload><br>为了解决多级页表访问速度慢的问题，加入了TLB（Translation Lookaside Buffer），常称为页表缓存。CPU寻址时，先搜索TLB，找不到再搜索页表。</p>
<h3 id="段页式内存管理"><a href="#段页式内存管理" class="headerlink" title="段页式内存管理"></a>段页式内存管理</h3><p>将内存先划分成有意义的段，然后按页分配。地址结构就由<strong>段号、段内页号和页内位移</strong>三部分组成。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/8904fb89ae0c49c4b0f2f7b5a0a7b099.webp" srcset="/img/loading.gif" lazyload></p>
<h3 id="Linux内存布局"><a href="#Linux内存布局" class="headerlink" title="Linux内存布局"></a>Linux内存布局</h3><p><em>Intel处理器内存</em><br>历史问题：先有段式内存管理，后续的页式管理就只能基于这个段式上做映射。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/bc0aaaf379fc4bc8882efd94b9052b64.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>Linux内存</em><br>页式管理：为了屏蔽段式管理，每个段都是0-&gt;4GB的整个虚拟空间。</p>
<p><em>虚拟地址空间分布</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/3a6cb4e3f27241d3b09b4766bb0b1124-20230309234553726.webp" srcset="/img/loading.gif" lazyload><br>所有进程虚拟地址空间中的内核空间关联了相同的物理内存：<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/48403193b7354e618bf336892886bcff.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>用户空间的段分布</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/32%E4%BD%8D%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.webp" srcset="/img/loading.gif" lazyload></p>
<h2 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h2><p><em>malloc分配内存</em><br>malloc函数有两种方式申请<strong>虚拟内存</strong>，申请后访问时出现缺页中断才会申请<strong>物理内存</strong>：</p>
<ul>
<li>brk()从堆中分配内存</li>
<li>mmap()在文件映射区中分配内存</li>
</ul>
<p>malloc(1)</p>
<p><em>free()释放内存</em></p>
<ul>
<li>brk()申请的内存：free释放内存时，会将内存缓存在内存池中以便复用，进程退出后才释放。</li>
<li>mmap()申请的内存：free释放内存时直接归还资源给操作系统。</li>
<li>内存块头信息：每个内存块有16Byte记录头信息，因此free时知道需要释放多少内存。</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/cb6e3ce4532ff0a6bfd60fe3e52a806e.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>mmap()的缺点</em><br>mmap会对操作系统频繁的申请、释放内存。频繁的缺页中断和切换运行态，对CPU造成了较大的消耗。</p>
<p><em>brk()的缺点</em><br>free释放的内存不归还操作系统，造成内存碎片。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/75edee0cb75450e7987a8a482b975bda.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>申请超过物理内存的虚拟内存</em></p>
<ul>
<li>32位：进程理论最大申请3GB虚拟内存，超出则申请失败。</li>
<li>64位：不会受理论最大空间限制。如果访问超出物理内存的虚拟内存，要看系统有没有 Swap 分区：<ul>
<li>如果没有 Swap 分区，OOM杀死进程。</li>
<li>如果有 Swap 分区，正常运行。</li>
</ul>
</li>
</ul>
<h2 id="内存回收"><a href="#内存回收" class="headerlink" title="内存回收"></a>内存回收</h2><p><em>申请内存过程</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/2f61b0822b3c4a359f99770231981b07.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>内存阈值</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/166bc9f5b7c545d89f1e36ab8dd772cf.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>超过页低阈值时开始异步回收</li>
<li>超过最小阈值时直接回收</li>
</ul>
<p><em>回收哪些内存</em></p>
<ul>
<li>文件页：直接释放，需要时再从磁盘读即可</li>
<li>匿名页：Swap机制，将内存换入磁盘</li>
</ul>
<p><em>回收算法</em><br>使用了<strong>LRU算法</strong>，维护了active和inactive两个双向链表，优先淘汰inactive。</p>
<p><em>回收性能消耗</em><br>文件页回收时脏页的写回、匿名页回收时的Swap操作都有较大的内存消耗。</p>
<p><em>回收性能优化</em></p>
<ul>
<li>调整文件页和匿名页的回收倾向，如多回收文件页，这样干净的文件页就不需要磁盘IO。</li>
<li>尽早触发kswapd异步回收内存，如调整页低阈值。</li>
</ul>
<p><em>NUMA架构</em></p>
<ul>
<li>一致性存储访问UMA架构：所有CPU共享硬件（总线、内存、IO等），导致CPU数量变多时，每个CPU资源变少。</li>
<li>非一致性存储访问NUMA架构：CPU分组，每组为一个Node，一个Node独立拥有硬件资源，访问远端资源时比本地内存耗时。</li>
</ul>
<p><em>NUMA架构下的垃圾回收</em><br>垃圾回收策略zone_reclaim_mode：</p>
<ul>
<li>0（默认）：回收本地内存前，在其他Node中寻找空闲内存。</li>
<li>1：只回收本地内存。</li>
<li>2：只回收本地内存，回收脏页。</li>
<li>4：只回收本地内存，回收匿名页</li>
</ul>
<p><em>OOM</em><br>OOM会对进程打分，因素有：</p>
<ul>
<li>内存使用的物理内存页面</li>
<li>OOM分数<code>oom_score_adj</code>，默认为0，范围-1000~1000。</li>
</ul>
<p>为了防止进程被OOM杀死，可调节其<code>oom_score_adj</code>为-1000，但不建议这样做。</p>
<h2 id="页面置换调度算法"><a href="#页面置换调度算法" class="headerlink" title="页面置换调度算法"></a>页面置换调度算法</h2><p><em>页面置换</em><br>页面置换算法指的是：解决当出现缺页异常，需调入新页面而内存已满时，如何选择被置换的物理页面的问题。为了实现页面置换算法，页表项有一些相关字段：<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%A1%B5%E8%A1%A8%E9%A1%B9%E5%AD%97%E6%AE%B5.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>状态位：是否是有效页</li>
<li>访问字段：一段时间内的被访问次数</li>
<li>修改位：是否为脏页</li>
<li>硬盘地址：页在硬盘上的地址</li>
</ul>
<p><em>最佳页面置换算法</em><br>置换在「未来」最长时间不访问的页面。是理想状态，但无法实现。</p>
<p><em>先进先出置换算法</em><br>选择在内存驻留时间很长的页面进行中置换。性能较差。</p>
<p><em>最近最久未使用的置换算法</em><br>LRU算法，理论上可行，但链表更新的时间复杂度较高，不常用。</p>
<p><em>时钟页面置换算法</em><br>与LRU类似，但更方便实现。优先置换访问频率低的页面，否则对页的访问频率计数降级。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%97%B6%E9%92%9F%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>最不常用算法</em><br>LRU算法，当发生缺页中断时，选择「访问次数」最少的那个页面，并将其淘汰。这种方法需要对计数做热点衰减以实现模拟近期的频率。</p>
<h3 id="Linux-内存页面置换"><a href="#Linux-内存页面置换" class="headerlink" title="Linux 内存页面置换"></a>Linux 内存页面置换</h3><p>Linux使用了双LRU链表实现页面置换算法，并对其做了一些优化。</p>
<p><em>预读失效和缓存污染</em><br>内存预读的目的是提高效率，但其可能造成预读失效和缓存勿污染，导致命中率下降。</p>
<p><em>预读失效</em></p>
<ul>
<li>定义：使用预读提前加载进来的页并没有被访问。</li>
<li>解决：没有被真正使用的页应该被视为冷数据：<ul>
<li>Linux使用了活跃LRU链表和非活跃LRU链表。</li>
<li>Mysql将LRU链表分为了young区和old区</li>
</ul>
</li>
</ul>
<p><em>缓存污染</em></p>
<ul>
<li>定义：只使用了一次的页占用热数据。</li>
<li>解决：降低热数据的门槛：<ul>
<li>Linux只有数据被访问第二次时才加入活跃链表。</li>
<li>Mysql只有数据两次访问时间之差<strong>超过1秒</strong>时才加入young区</li>
</ul>
</li>
</ul>
<h1 id="四、进程管理"><a href="#四、进程管理" class="headerlink" title="四、进程管理"></a>四、进程管理</h1><h2 id="进程、线程与调度"><a href="#进程、线程与调度" class="headerlink" title="进程、线程与调度"></a>进程、线程与调度</h2><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p><em>进程七态模型</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/10-%E8%BF%9B%E7%A8%8B%E4%B8%83%E4%B8%AD%E7%8A%B6%E6%80%81.webp" srcset="/img/loading.gif" lazyload><br>为了避免阻塞的进程浪费物理内存，将其换出到硬盘，运行时再换回。</p>
<p><em>进程控制块PCB组成</em></p>
<ul>
<li>进程描述信息（pid，userid）</li>
<li>进程控制和管理信息（状态、优先级）</li>
<li>资源分配（内存地址空间信息）</li>
<li>CPU寄存信息</li>
</ul>
<p><em>进程控制块PCB组织</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/12-PCB%E7%8A%B6%E6%80%81%E9%93%BE%E8%A1%A8%E7%BB%84%E7%BB%87.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>进程的控制</em><br>进程的控制主要包括<strong>创建、终止、阻塞、唤醒</strong>。具体的过程总结下来就是：</p>
<ul>
<li>查找&#x2F;创建PCB</li>
<li>判断PCB状态，根据指令改变进程状态。</li>
<li>申请&#x2F;释放资源</li>
<li>删除&#x2F;移动PCB</li>
</ul>
<p><em>进程上下文切换</em><br>进程阻塞或时间片用完等情况时需要切换线程，此时会把CPU上下文（寄存器和程序计数器）保存到PCB中，下次运行时恢复。</p>
<h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><p><em>定义</em><br>线程是进程当中的一条执行流程。</p>
<p><em>进程与线程对比</em></p>
<ul>
<li>进程是资源分配的单位，线程是CPU调度的单位。</li>
<li>进程信息只有寄存器和栈，创建、释放、上下文切换更快速。</li>
<li>线程之间通过同一个进程的内存实现数据共享。</li>
</ul>
<p><em>线程实现</em></p>
<ul>
<li>用户线程：多对一，用户空间实现线程管理TCB</li>
<li>内核线程：一对一，线程TCB由操作系统管理</li>
<li>轻量级进程：内核支持的用户线程，与内核线程一对一</li>
</ul>
<p><em>各种线程实现的注意点</em></p>
<ul>
<li>用户线程不需要切换内核态调度，但可能阻塞饿死其他线程。内核线程相反。</li>
<li>用户线程可以在轻量级进程上再实现M：N的线程对应模型。</li>
</ul>
<p><em>一个进程可以创建多少线程</em><br>进程需要为线程在虚拟内存空间中创建栈空间：</p>
<ul>
<li>32位：主要受线程的栈空间大小和<strong>用户态虚拟内存空间</strong>（Linux下为3G）大小的限制。</li>
<li>64位：虚拟内存足够，主要受系统参数和性能的限制。</li>
</ul>
<h3 id="进程调度"><a href="#进程调度" class="headerlink" title="进程调度"></a>进程调度</h3><p><em>需要调度的情况</em></p>
<ul>
<li>线程就绪态 -&gt; 运行态</li>
<li>线程运行态 -&gt; 阻塞态</li>
<li>线程运行态 -&gt; 结束态</li>
<li>其他优先级等因素导致的调度</li>
</ul>
<p><em>时钟中断</em><br>以某个时间频率检查进程状态，考虑是否调度CPU资源。<br>根据是否使用时钟中断，调度算法分：</p>
<ul>
<li>非抢占式调度算法：让进程运行到阻塞或退出再调度。</li>
<li>抢占式调度算法：触发时钟中断，然后将CPU资源给调度程序，执行调度程序后再给进程分配CPU程序。</li>
</ul>
<p><em>调度相关指标</em></p>
<ul>
<li>CPU利用率：CPU工作时间&#x2F;总时间</li>
<li>系统吞吐量：单位时间CPU完成的进程数量</li>
<li>进程周转时间：运行+阻塞+等待的时间</li>
<li>等待时间：进程处于就绪态的时间</li>
<li>响应时间：用户请求到返回的时间</li>
</ul>
<p><em>调度算法</em><br>针对长、短作业：</p>
<ul>
<li>先来先服务FCFS：对长作业有利，但短作业等待时间太久。</li>
<li>最短作业优先SJF：对短作业有利，但长作业饿死。</li>
<li>高响应比优先HRRN：平衡长、短作业。但要求服务时间无法预估，其无法实现。</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/26-%E5%93%8D%E5%BA%94%E6%AF%94%E5%85%AC%E5%BC%8F.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>时间片轮转RR：时间上公平。但时间片太短会造成上下文切换频繁资源浪费，太长则短作业浪费CPU资源。</li>
</ul>
<p>引入优先级：</p>
<ul>
<li>最高优先级HPF：优先级分静态优先级和动态优先级（进程优先级随等待时间变化），处理分非抢占式和抢占式。但低优先级一直得不到执行。</li>
<li>多级反馈队列MFQ：设置多级的就绪队列，高优先级作业获得执行后若梅结束会降低优先级，低优先级作业能获得更多的时间片。兼顾了长短作业，短作业在前面的队列即完成执行，长作业也可以获得更长的运行时间。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/28-%E5%A4%9A%E7%BA%A7%E9%98%9F%E5%88%97.webp" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="Linux-CPU调度"><a href="#Linux-CPU调度" class="headerlink" title="Linux CPU调度"></a>Linux CPU调度</h2><p>Linux的CPU调度方式类似多级反馈队列算法：分实时作业和普通作业，实现优先级；根据进程已经获得的执行时间动态调节其优先级，保证公平。<br><em>线程调度</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%BB%BB%E5%8A%A1.webp" srcset="/img/loading.gif" lazyload><br>所有线程在Linux调度器中都是一个task_struct。</p>
<p><em>任务分类</em></p>
<ul>
<li>实时任务：优先级0-99范围。</li>
<li>普通任务：优先级100-129范围。</li>
</ul>
<p><em>调度类</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%B0%83%E5%BA%A6%E7%B1%BB.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>调度策略</em><br>DeadLine和RT调度器用于实时任务，调度策略：</p>
<ul>
<li>SCHED_DEADLINE：按照deadline优先级调度。</li>
<li>SCHED_FIFO：优先级高的先服务，相同优先级先到先服务。</li>
<li>SCHED_RR：高优先级的任务可以抢夺低优先级任务的时间，相同优先级的任务轮流执行。</li>
</ul>
<p>Fair调度类用于普通任务，调度策略：</p>
<ul>
<li>SCHED_NORMAL：普通任务使用的调度策略。</li>
<li>SCHED_BATCH：后台任务的调度策略。</li>
</ul>
<p><em>完全公平调度</em><br>CFS调度器会通过计算vruntime保证任务公平，优先执行vruntime少的任务：<br>vruntime +&#x3D; 实际运行时间delta_exec * NICE_0_LOAD&#x2F;权重</p>
<p><em>CPU运行队列</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/CPU%E9%98%9F%E5%88%97.webp" srcset="/img/loading.gif" lazyload><br>优先级如下：Deadline &gt; Realtime &gt; Fair</p>
<p><em>默认优先级</em><br>默认情况下，任务都是普通任务，调度类为Fair，若想要调整任务优先级，可以启动时指定nice值。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%BC%98%E5%85%88%E7%BA%A7.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>中断</em><br>从调度的角度，中断是一种抢占性的任务调度行为；从程序的角度，中断是一种异步的事件处理机制，操作系统收到了中断请求，会打断其他进程的运行，并执行中断处理程序。</p>
<p><em>软中断</em><br>为了解决中断处理程序执行过长和中断丢失的问题，将中断过程分成了两个阶段，分别是「上半部和下半部分」。</p>
<ul>
<li>上半部分处理硬件请求（硬中断）：短暂关闭中断请求，立即执行中断处理程序。</li>
<li>下半部分由内核触发（软中断）：使用内核线程ksoftirqd延迟处理中断回调函数。</li>
</ul>
<h2 id="进程之间的通讯方式"><a href="#进程之间的通讯方式" class="headerlink" title="进程之间的通讯方式"></a>进程之间的通讯方式</h2><p><em>管道</em></p>
<ul>
<li>单向传输</li>
<li>命名管道<code>mkfifo</code>保存在文件中、匿名管道保存在内存中。本质上就是内存中的一串缓存。</li>
<li>会阻塞直到管道内容被读取</li>
<li>匿名管道只能在父子关系的进程中通过共享文件描述符的方式通讯，eg:shell中使用<code>A|B</code>：</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/8-%E7%AE%A1%E9%81%93-pipe-shell.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>消息队列</em></p>
<ul>
<li>异步，但通讯不及时</li>
<li>大小有限制，本质上是内核中的消息链表、</li>
<li>存在内核态切换开销</li>
</ul>
<p><em>共享内存</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/9-%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>信号量</em></p>
<ul>
<li>整形计数器，支持P、V操作。<ul>
<li>P操作：-1，发现≥0后执行，否则阻塞。</li>
<li>V操作：+1，发现≤0后唤醒阻塞线程。</li>
</ul>
</li>
<li>初始化为1可实现互斥（先P后V），初始化为0可实现序列化（先V后P）</li>
</ul>
<p><em>信号</em><br><code>kill -?</code><br>进程间<strong>唯一的异步通讯机制</strong>，进程对接受到的信号可执行默认操作，也可以捕捉处理信号。（SIGKILL和SIGSTOP无法被捕捉忽略，即强制结束或中断）</p>
<blockquote>
<p>线程崩溃了，进程会崩溃吗？<br>不一定，崩溃本身是系统通过信号通知进程执行退出的过程。如Java对部分信号如SIGSEGV进行了捕获，不会直接退出整个JVM。</p>
</blockquote>
<p><em>Socket</em><br>实现跨网络和主机的进程通讯，系统调用参数有：</p>
<ul>
<li>协议：IPV4、IPV6或本地等（本地socket不需要绑定ip和端口，而是绑定本地文件，效率比网络socket高。）。</li>
<li>类型：UDP、TCP等。</li>
<li>协议：默认0，已经废弃。</li>
</ul>
<h2 id="线程冲突与死锁"><a href="#线程冲突与死锁" class="headerlink" title="线程冲突与死锁"></a>线程冲突与死锁</h2><p><em>互斥与同步的定义</em></p>
<ul>
<li>互斥：临界区代码是互斥的，只允许一个线程在临界区执行。</li>
<li>同步：并发线程在某些时间点要形成互相等待与互通消息。</li>
</ul>
<p><em>互斥同步的实现</em></p>
<ul>
<li>锁：实现互斥</li>
<li>信号量：init 1实现互斥，init 0实现同步</li>
</ul>
<p><em>死锁的条件</em><br>只有同时满足以下4个条件才能形成死锁。</p>
<ul>
<li>互斥条件：唯一资源</li>
<li>不可剥夺：不会主动释放</li>
<li>持有等待：等待另一个唯一资源</li>
<li>环路等待：形成了环路等待</li>
</ul>
<p><em>排查死锁</em><br><code>jstack</code>可排查死锁</p>
<p><em>避免死锁</em><br>一般会破坏环路等待，即编码时使资源的获取有序。</p>
<h3 id="同步问题"><a href="#同步问题" class="headerlink" title="同步问题"></a>同步问题</h3><p><em>生产者消费者问题</em></p>
<ul>
<li>一个互斥信号量实现访问互斥</li>
<li>一个同步信号量初始化为0实现notEmpty通知</li>
<li>一个同步信号量初始化为n实现notFull通知</li>
</ul>
<p><em>哲学家就餐问题</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/23-%E5%93%B2%E5%AD%A6%E5%AE%B6%E8%BF%9B%E9%A4%90%E6%A8%A1%E5%9E%8B.webp" srcset="/img/loading.gif" lazyload><br>哲学家需要同时拿起左右两侧的叉子才吃面，如何防止死锁：</p>
<ul>
<li>一个互斥信号量代表当前是否有人拿起筷子：只有没人拿起筷子时，才允许拿筷子，效率较低。</li>
<li>五个互斥信号量代表叉子：偶数先拿左边，奇数先拿右边。</li>
<li>五个互斥信号量代表人：只有两个邻居都没有拿起筷子时，才允许拿筷子。</li>
</ul>
<p><em>读者-写者问题</em><br>为了保证读者和写者都不被饿死，读者和写者应该在同一个队列中等待，实现FIFO：</p>
<ul>
<li>一个普通量记录读者数量</li>
<li>一个互斥信号量控制对读者数量的修改</li>
<li>一个互斥信号量控制写者写操作</li>
<li><strong>一个互斥信号量保证写者排队时，后续读者阻塞</strong>。</li>
</ul>
<h3 id="银行家算法"><a href="#银行家算法" class="headerlink" title="银行家算法"></a>银行家算法</h3><p>银行家算法是资源分配层面上避免死锁的著名方法。<br><em>条件</em></p>
<ul>
<li>系统当前可利用资源向量Avaliable</li>
<li>进程最大需求矩阵Max</li>
<li>进程当前分配矩阵Allocate</li>
<li>进程需求矩阵Need（进程需求矩阵 &#x3D; 进程最大需求矩阵-进程当前分配矩阵）</li>
</ul>
<p><em>银行家算法</em></p>
<ul>
<li>进程请求资源大于其最大需求资源时出现错误，不分配</li>
<li>进程请求资源大于可利用资源时，不分配</li>
<li>否则，可以尝试分配，执行安全性算法。</li>
</ul>
<p><em>安全性算法</em><br>安全性算法的目的就是找到一个安全执行序列，难点在于如何判断找不到该安全序列。</p>
<ol>
<li>第一轮：先假定一个序列，逐个判断进程是否能被执行。</li>
<li>第二轮：第一轮中能够被执行的进程添加到安全序列中，再次遍历该序列，这次只针对第一轮中判断无法被执行的进程判断。</li>
<li>如果第二轮中发现了新的可被执行进程，则循环第二轮；如果某轮发现剩余进程都无法执行，则说明找不到安全序列。</li>
</ol>
<h1 id="五、文件系统"><a href="#五、文件系统" class="headerlink" title="五、文件系统"></a>五、文件系统</h1><h2 id="文件系统组成和基本使用"><a href="#文件系统组成和基本使用" class="headerlink" title="文件系统组成和基本使用"></a>文件系统组成和基本使用</h2><p><em>概念</em></p>
<ul>
<li>文件：普通的文件，其数据块中记录文件数据，保存在硬盘中。</li>
<li>目录：特殊的文件，其数据块中记录文件信息（文件名和文件inode号，并使用一个hash表维护inode号和块号），保存在硬盘中。</li>
<li>目录项：内核维护的数据结构，缓存在内存中，其既可以表示目录，也可以表示文件。</li>
</ul>
<p><em>硬链接与软连接</em><br>硬链接：是<strong>多个目录项中的「索引节点」指针指向一个文件</strong>，也就是指向同一个inode。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A1%AC%E9%93%BE%E6%8E%A5-2.webp" srcset="/img/loading.gif" lazyload></p>
<p>软连接：创建独立的inode，可以跨文件系统。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%BD%AF%E9%93%BE%E6%8E%A5.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>基本结构</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%9B%AE%E5%BD%95%E9%A1%B9%E5%92%8C%E7%B4%A2%E5%BC%95%E5%85%B3%E7%B3%BB%E5%9B%BE.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>超级块：存储文件系统信息，文件系统挂载时进入内存。</li>
<li>索引节点：存储索引节点，文件被访问时进入内存。</li>
</ul>
<blockquote>
<p>用户进程对文件的基本操作单位是<strong>字节</strong>，文件系统的基本操作单位是<strong>数据块</strong>，文件系统则屏蔽了这种操作差异。</p>
</blockquote>
<p><em>虚拟文件系统</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.webp" srcset="/img/loading.gif" lazyload><br>操作系统需要为用户提供统一的文件接口，根据存储位置不同，分为：</p>
<ul>
<li>磁盘文件系统（如Ext 2）</li>
<li>内存文件系统（如<code>/proc</code>）</li>
<li>网络文件系统（如NFS）</li>
</ul>
<p><em>文件的使用</em><br><code>open()</code>、<code>write()</code>、<code>read()</code>。<br>每个进程会维护一个打开文件表，每一项通过一个文件描述符，记录：</p>
<ul>
<li>文件指针</li>
<li>打开计数器</li>
<li>文件磁盘位置</li>
<li>访问权限</li>
</ul>
<h2 id="文件的存储"><a href="#文件的存储" class="headerlink" title="文件的存储"></a>文件的存储</h2><p><em>连续空间存储方式</em><br>文件头需要指定起始块位置和长度。会造成<strong>磁盘空间碎片</strong>和<strong>文件长度不易扩展</strong>的问题。</p>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E5%AD%98%E6%94%BE%E6%96%B9%E5%BC%8F.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>非连续空间存放方式</em></p>
<ul>
<li><p>隐式链表：每个数据块用一个指针存放下一块的位置。缺点为必须遍历访问；稳定性差，若一个指针丢失则文件不可用。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%9D%9E%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E5%AD%98%E6%94%BE%E6%96%B9%E5%BC%8F-%E9%93%BE%E8%A1%A8%E6%96%B9%E5%BC%8F.webp" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>显式链表：使用<strong>文件分配表</strong>，显示的记录文件使用的磁盘块链，遍历到-1说明结束。缺点为由于文件分配表存在于内存中，其不适用大磁盘。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%96%87%E4%BB%B6%E5%88%86%E9%85%8D%E8%A1%A8.webp" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>索引方式：为每个文件创建<strong>索引数据块</strong>，相当于文件的数据块目录。当文件过大一个索引块不够用时，可以使用<strong>链式索引块</strong>或<strong>多级索引块</strong>。</p>
</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%9D%9E%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E5%AD%98%E6%94%BE%E6%96%B9%E5%BC%8F-%E7%B4%A2%E5%BC%95%E6%96%B9%E5%BC%8F.webp" srcset="/img/loading.gif" lazyload><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E9%93%BE%E5%BC%8F%E7%B4%A2%E5%BC%95%E5%9D%97.webp" srcset="/img/loading.gif" lazyload><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95%E5%9D%97.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>文件存储方式对比</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F%E6%AF%94%E8%BE%83.webp" srcset="/img/loading.gif" lazyload></p>
<h4 id="Unix文件实现"><a href="#Unix文件实现" class="headerlink" title="Unix文件实现"></a>Unix文件实现</h4><p>Linux Ext 2&#x2F;3文件系统方案如下，其适用于不同大小的文件索引需求：<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Unix-%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95.webp" srcset="/img/loading.gif" lazyload></p>
<h2 id="空闲空间管理"><a href="#空闲空间管理" class="headerlink" title="空闲空间管理"></a>空闲空间管理</h2><p><em>空闲表法</em><br>为所有空闲空间建立一张表，空间消耗大且查询效率较低。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A9%BA%E9%97%B2%E8%A1%A8%E6%B3%95.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>空闲链表法</em><br>主存只需要保存一个指针，简单，但无法随机访问，查询效率低。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E7%A9%BA%E9%97%B2%E5%9D%97%E9%93%BE%E8%A1%A8.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>位图法</em><br>使用bitmap记录磁盘块的使用情况，Linux中采用的方案。位图存储在磁盘中。</p>
<p><em>文件系统结构</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%9D%97%E7%BB%84.webp" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>块组0类似数据库设计中表空间的第一个页的作用。</p>
</blockquote>
<h2 id="文件缓存与I-x2F-O"><a href="#文件缓存与I-x2F-O" class="headerlink" title="文件缓存与I&#x2F;O"></a>文件缓存与I&#x2F;O</h2><p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/72568a29816fa9b505f15edac68adee2.webp" srcset="/img/loading.gif" lazyload><br><em>概念</em></p>
<ul>
<li>Page Cache是操作系统中的内存缓存，其由多个page组成。</li>
<li>Swap out时换出的内存Swap Cached也可以被视为Page Cache。</li>
<li>Page Cache用于缓存文件的页数据，与文件系统同级；buffer cache用于缓存块设备（如磁盘）的块数据，与驱动程序同级；现在两者已经几乎被统一了，统称为<code>Page Cache</code>。</li>
</ul>
<p><em>预读机制</em><br>read时，内核调用了readhead。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/ae8252378169c8c14b8b9907983f7d8b-20230309235145646.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>一致性与可靠性保证</em><br>Linux 下以两种方式实现文件一致性：</p>
<ul>
<li>写穿(Write Through)：同步写入磁盘，保证一致性。</li>
<li>写回(Write Back)：默认方案，定时任务将Page Cache刷回脏数据块，无法保证一致性。</li>
</ul>
<p><em>文件I&#x2F;O</em></p>
<ul>
<li>缓冲与非缓冲 I&#x2F;O：根据「是否利用标准库缓冲」，可以把文件 I&#x2F;O 分为缓冲 I&#x2F;O 和非缓冲 I&#x2F;O。</li>
<li>直接与非直接I&#x2F;O：根据是「否利用操作系统的缓存（Page Cache）」，可以把文件 I&#x2F;O 分为直接 I&#x2F;O 与非直接 I&#x2F;O。直接I&#x2F;O不会发生内核缓存和用户程序之间数据复制。</li>
<li>阻塞与非阻塞I&#x2F;O：见后文I&#x2F;O模型。</li>
</ul>
<h1 id="六、设备管理"><a href="#六、设备管理" class="headerlink" title="六、设备管理"></a>六、设备管理</h1><p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230409194607.png" srcset="/img/loading.gif" lazyload><br><em>概念</em></p>
<ul>
<li>每个设备都有一个叫<strong>设备控制器（Device Control）</strong>。</li>
<li>控制器是有三类寄存器：<ul>
<li>状态寄存器（Status Register）：命令执行状态</li>
<li>命令寄存器（Command Register）：具体命令</li>
<li>数据寄存器（Data Register）：命令参数</li>
</ul>
</li>
<li>按照数据存在位置可分为两大类：<ul>
<li>块设备（Block Device）：硬盘等数据保存在块中的设备</li>
<li>字符设备（Character Device）：鼠标等数据只以字符形式在数据流中存在的设备。</li>
</ul>
</li>
<li>按通讯方式可以分两大类：<ul>
<li>端口I&#x2F;O：每个寄存器分配一个端口</li>
<li>内存映射：将寄存器映射到内存空间</li>
</ul>
</li>
</ul>
<p><em>I&#x2F;O控制方式</em></p>
<ul>
<li>轮询等待：CPU轮询寄存器</li>
<li>中断机制：包括硬中断、软中断</li>
</ul>
<p><em>设备驱动程序</em><br>设备驱动程序会提供<strong>统一的接口</strong>给操作系统，它会及时<strong>响应控制器发来的中断请求</strong>，并根据这个中断的类型调用响应的<strong>中断处理程序</strong>进行处理。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%B8%AD%E6%96%AD%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>块设备管理</em><br>为了屏蔽不同块设备差异，Linux通过统一的<strong>通用块层</strong>来管理块设备。通用块层是处于文件系统和磁盘驱动中间的一个块设备抽象层，其向上提供标准接口，向下实现I&#x2F;O调度和管理。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/I_O%E8%BD%AF%E4%BB%B6%E5%88%86%E5%B1%82.webp" srcset="/img/loading.gif" lazyload></p>
<p><em>键盘敲入字母后，发生了什么？</em></p>
<ul>
<li>键盘控制器扫描到数据，将其缓冲到寄存器中并发起<strong>中断请求</strong>。</li>
<li>CPU收到中断请求，保存当前CPU上下文，<strong>调用键盘的中断处理程序</strong>。</li>
<li>中断处理程序<strong>读取寄存器缓冲区数据并识别处理</strong>，将识别到的字符放入显示设备的<strong>读缓冲区队列</strong>。</li>
<li>显示设备将<strong>读缓冲区队列</strong>数据放入<strong>写缓冲区队列</strong>，然后写入到显示设备的<strong>寄存器数据缓冲区</strong>。</li>
<li><strong>恢复被中断的进程上下文</strong>。</li>
</ul>
<h1 id="七、网络系统"><a href="#七、网络系统" class="headerlink" title="七、网络系统"></a>七、网络系统</h1><h2 id="DMA技术"><a href="#DMA技术" class="headerlink" title="DMA技术"></a>DMA技术</h2><p><strong>直接内存访问</strong>(Direct Memory Access)：将I&#x2F;O设备与内存间的数据传输工作交给DMA控制器。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/DRM-I_O-%E8%BF%87%E7%A8%8B.webp" srcset="/img/loading.gif" lazyload></p>
<h2 id="零拷贝技术"><a href="#零拷贝技术" class="headerlink" title="零拷贝技术"></a>零拷贝技术</h2><ul>
<li><p>传统文件传输<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%BC%A0%E7%BB%9F%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93.webp" srcset="/img/loading.gif" lazyload><br>发生了4次状态切换和4次拷贝。</p>
</li>
<li><p>mmap+write</p>
</li>
</ul>
<p><img src="/mmap%20+%20write%20%E9%9B%B6%E6%8B%B7%E8%B4%9D.webp" srcset="/img/loading.gif" lazyload><br>发生了4次状态切换和3次拷贝。</p>
<ul>
<li>sendfile</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/senfile-3%E6%AC%A1%E6%8B%B7%E8%B4%9D.webp" srcset="/img/loading.gif" lazyload><br>发生了2次状态切换和3次拷贝。</p>
<ul>
<li>sendfile(网卡支持SG-DMA时)</li>
</ul>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/senfile-%E9%9B%B6%E6%8B%B7%E8%B4%9D.webp" srcset="/img/loading.gif" lazyload><br>发送了2次状态切换和2次拷贝。</p>
<h2 id="大文件传输"><a href="#大文件传输" class="headerlink" title="大文件传输"></a>大文件传输</h2><p><em>内核缓冲区</em><br>内核缓冲区本质上是page cache，零拷贝中使用到了这个技术。但对于过大的文件（GB级别），使用零拷贝会过度占用page cache。因此，<strong>传输大文件时不应该使用零拷贝技术</strong>。</p>
<p><em>大文件传输方案</em><br>在高并发的场景下，针对大文件的传输的方式，应该使用 <strong>「异步 I&#x2F;O + 直接 I&#x2F;O」</strong> 来替代零拷贝技术：</p>
<ul>
<li>直接 I&#x2F;O 绕过了 PageCache</li>
<li>异步 I&#x2F;O 避免了直接 I&#x2F;O效率较慢的阻塞</li>
</ul>
<p><em>总结</em></p>
<ul>
<li>小文件用零拷贝技术</li>
<li>大文件用异步I&#x2F;O+直接I&#x2F;O技术</li>
</ul>
<h2 id="Unix-I-x2F-O模型"><a href="#Unix-I-x2F-O模型" class="headerlink" title="Unix I&#x2F;O模型"></a>Unix I&#x2F;O模型</h2><h3 id="IO阶段"><a href="#IO阶段" class="headerlink" title="IO阶段"></a>IO阶段</h3><p>一个输入操作通常包括<strong>两个阶段</strong>:</p>
<ol>
<li>等待数据准备</li>
<li>等待从内核向进程复制数据</li>
</ol>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p><em>同步IO</em></p>
<ul>
<li>阻塞式I&#x2F;O(<code>recvfrom</code>)</li>
<li>非阻塞式I&#x2F;O(<code>recvfrom</code>)</li>
<li>多路复用I&#x2F;O(<code>select</code>或<code>poll</code>+<code>recvfrom</code>)</li>
<li>信号驱动式I&#x2F;O(<code>sigaction</code>+<code>recvfrom</code>)</li>
</ul>
<p><em>异步IO</em></p>
<ul>
<li>异步I&#x2F;O(<code>aio_read</code>)</li>
</ul>
<p><em>文件、网络I&#x2F;O</em></p>
<ul>
<li>多路复用I&#x2F;O模型中的<strong>select等方法</strong>主要针对socket的读写，是网络I&#x2F;O模型。</li>
<li>其他I&#x2F;O模型既可以用于网络I&#x2F;O，又可以用于文件I&#x2F;O。</li>
</ul>
<h4 id="阻塞式-I-x2F-O"><a href="#阻塞式-I-x2F-O" class="headerlink" title="阻塞式 I&#x2F;O"></a>阻塞式 I&#x2F;O</h4><p>应用调用<code>recvfrom</code>，被阻塞，直到数据复制到应用进程缓冲区中才返回。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213143753.png" srcset="/img/loading.gif" lazyload><br>阻塞的过程中，其它程序还可以执行，因此阻塞不意味着整个操作系统都被阻塞。</p>
<h4 id="非阻塞式I-x2F-O"><a href="#非阻塞式I-x2F-O" class="headerlink" title="非阻塞式I&#x2F;O"></a>非阻塞式I&#x2F;O</h4><p>应用进程不断的执行<code>recvfrom</code>来获知 I&#x2F;O 是否完成，这种方式称为轮询(<code>polling</code>)。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213143817.png" srcset="/img/loading.gif" lazyload><br>由于 CPU 要处理更多的系统调用，因此这种模型是比较低效的。</p>
<h4 id="多路复用I-x2F-O"><a href="#多路复用I-x2F-O" class="headerlink" title="多路复用I&#x2F;O"></a>多路复用I&#x2F;O</h4><ol>
<li>使用<code>select</code>或者<code>poll</code>等待数据（<strong>支持阻塞和非阻塞</strong>），并且可以<strong>等待多个套接字</strong>中的任何一个变为可读，当某一个套接字可读时返回。</li>
<li>使用<code>recvfrom</code>把数据从内核复制到进程中。</li>
</ol>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150145.png" srcset="/img/loading.gif" lazyload><br>I&#x2F;O多路复用本质上仍然是<strong>阻塞IO</strong>，只不过其将阻塞等待数据准备的过程交给了操作系统进行监听，且一次可以注册多个socket，从而使单个进程具有处理多个I&#x2F;O事件的能力。</p>
<h4 id="信号驱动I-x2F-O"><a href="#信号驱动I-x2F-O" class="headerlink" title="信号驱动I&#x2F;O"></a>信号驱动I&#x2F;O</h4><ol>
<li>应用进程使用 <code>sigaction</code> 系统调用，内核立即返回(非阻塞)。</li>
<li>内核在数据到达时向应用进程发送 <code>SIGIO</code> 信号，应用进程收到之后在信号处理程序中调用 <code>recvfrom</code> 将数据从内核复制到应用进程中。</li>
</ol>
<p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150246.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="异步I-x2F-O"><a href="#异步I-x2F-O" class="headerlink" title="异步I&#x2F;O"></a>异步I&#x2F;O</h4><ol>
<li>应用进行 aio_read 系统调用立即返回。</li>
<li>内核会在所有操作完成之后向应用进程发送信号。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150315.png" srcset="/img/loading.gif" lazyload></li>
</ol>
<h3 id="I-x2F-O模型比较"><a href="#I-x2F-O模型比较" class="headerlink" title="I&#x2F;O模型比较"></a>I&#x2F;O模型比较</h3><h4 id="阻塞、非阻塞、同步、非同步"><a href="#阻塞、非阻塞、同步、非同步" class="headerlink" title="阻塞、非阻塞、同步、非同步"></a>阻塞、非阻塞、同步、非同步</h4><p><em>阻塞的概念</em><br>阻塞是一般指，应用程序调用某系统函数后，是否需要等待操作系统准备好资源。</p>
<p><em>IO场景</em><br>具体到IO场景，等待分「内核数据准备好」和「数据从内核态拷贝到用户态」这两个过程，做出了以下分类。</p>
<p><em>阻塞与非阻塞</em></p>
<ul>
<li>强调的是应用行为，即在等待函数执行结果时的行为，如果一直阻塞等待则是阻塞的，如果直接返回了当前的状态则是非阻塞的。</li>
<li>阻塞IO与非阻塞IO：讨论的是第一阶段是否需要阻塞，即应用程序是否等待资源准备好。</li>
</ul>
<p><em>同步与异步</em></p>
<ul>
<li>强调的是通讯机制，即应用执行函数时直接返回（异步肯定是非阻塞的），执行完毕后通知应用结果。</li>
<li>同步IO与异步IO：讨论的是第二阶段是否需要阻塞，即应用程序是否等待资源拷贝到用户空间内存。</li>
</ul>
<p><em>阻塞socket与非阻塞socket</em><br>首先明确，socket本身只是一个文件描述符，执行函数时会根据其模式判断执行方式。</p>
<ul>
<li>Windows和Linux，创建<code>socket</code>都是阻塞模式的；</li>
<li>Linux中,可以在创建<code>socket</code>是直接将它设置为非阻塞模式；</li>
</ul>
<p><em>accept&#x2F;connect&#x2F;recv&#x2F;read&#x2F;send&#x2F;write</em><br>在网络I&#x2F;O中，这些函数根据socket的模式决定是否阻塞等待资源准备好。</p>
<ul>
<li>其中，recv&#x2F;read等待的资源是应用程序接受缓冲区。</li>
<li>其中，send&#x2F;write等待的资源是内核缓存区，如果缓冲区满了且在非阻塞状态会返回发送失败。</li>
</ul>
<p><em>select&#x2F;poll&#x2F;epoll</em><br>这些函数始终是阻塞的函数，可以设置超时时间实现<strong>类似</strong>非阻塞的状态。</p>
<h4 id="五大I-x2F-O模型比较"><a href="#五大I-x2F-O模型比较" class="headerlink" title="五大I&#x2F;O模型比较"></a>五大I&#x2F;O模型比较</h4><p><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230213150509.png" srcset="/img/loading.gif" lazyload><br>这些I&#x2F;O模型描述的是一次I&#x2F;O行为的过程，而一个网络应用需要处理大量不同类型的Socket，故会使用多种I&#x2F;O模型组合的架构。</p>
<h3 id="I-x2F-O多路复用"><a href="#I-x2F-O多路复用" class="headerlink" title="I&#x2F;O多路复用"></a>I&#x2F;O多路复用</h3><h4 id="多进程模型"><a href="#多进程模型" class="headerlink" title="多进程模型"></a>多进程模型</h4><p>基于阻塞I&#x2F;O。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230405144258.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h4><p>基于阻塞I&#x2F;O，但节省了进程创建销毁的开销。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Pasted-image-20230405144507.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="网络I-x2F-O多路复用"><a href="#网络I-x2F-O多路复用" class="headerlink" title="网络I&#x2F;O多路复用"></a>网络I&#x2F;O多路复用</h4><p>之前的方法在进行网络I&#x2F;O时都需要至少一个线程维护一个socket，造成了大量的浪费，I&#x2F;O多路复用使用一个线程监听多个socket上的事件，并对其逐一处理。</p>
<h5 id="select-x2F-poll"><a href="#select-x2F-poll" class="headerlink" title="select&#x2F;poll"></a>select&#x2F;poll</h5><p><em>过程</em></p>
<ul>
<li>将已连接的 Socket 都放到一个<strong>文件描述符集合</strong>，然后调用 select&#x2F;poll 函数将文件描述符集合<strong>拷贝</strong>到内核里，让内核来检查是否有网络事件产生。</li>
<li>内核<strong>遍历</strong>检查发现事件后，将该Socket标记，并<strong>拷贝</strong>回用户态。</li>
<li>用户态再<strong>遍历</strong>找到可读、可写的事件并处理。</li>
</ul>
<p><em>select</em><br>使用bitmap存储文件描述符集合，只能监听1024个socket。</p>
<p><em>poll</em><br>使用链表存储文件描述符集合，突破了1024个，但仍然受系统限制。</p>
<h5 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h5><p><em>过程</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/epoll.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>epoll在为应用在内核中维护一个<strong>文件描述符</strong>红黑树，用户需要新增加socket时，只需要调用<code>epoll_ctl()</code>即可，不再需要拷贝整个集合。</li>
<li>epoll使用了一个链表记录就绪事件，当用户调用<code>epoll_wait()</code>时，只会复制就绪链表中的socket到用户态进行处理。</li>
</ul>
<p><em>触发模式</em></p>
<ul>
<li>LT 水平触发：进程调用epoll_wait()，当有可读事件发生时，服务器端不断地从 epoll_wait 中苏醒，直到内核缓冲区数据被 read 函数读完才结束，<strong>支持阻塞I&#x2F;0和非阻塞I&#x2F;0</strong>，是默认的触发模式。</li>
<li>ET 边缘触发：进程调用epoll_wait()，服务器端只会从 epoll_wait 中苏醒一次，只支持<strong>非阻塞I&#x2F;O</strong>。</li>
</ul>
<p><em>触发模式对比</em></p>
<ul>
<li>LT是默认的触发模式；</li>
<li>ET模式因为要循环读完所有数据后要正常返回而不是阻塞，所以只支持非阻塞I&#x2F;O；</li>
<li>ET模式因为epoll_wait苏醒的次数少，效率更高。</li>
</ul>
<h3 id="I-x2F-O复用模型对比"><a href="#I-x2F-O复用模型对比" class="headerlink" title="I&#x2F;O复用模型对比"></a>I&#x2F;O复用模型对比</h3><ul>
<li>select实时性更高，一致性更好</li>
<li>poll无最大描述符限制</li>
<li>epoll处理大量文件描述符时最好</li>
</ul>
<h2 id="高性能网络模式"><a href="#高性能网络模式" class="headerlink" title="高性能网络模式"></a>高性能网络模式</h2><p>基于I&#x2F;O多路复用模型的特性，在应用程序中实现高性能的网络模式，主要有Reactor、Proactor模型。</p>
<h3 id="Reactor模型"><a href="#Reactor模型" class="headerlink" title="Reactor模型"></a>Reactor模型</h3><p>非阻塞同步网络模式，组成有Reactor、Acceptor、Handler。<br><em>单Reactor单线程</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%8D%95Reactor%E5%8D%95%E8%BF%9B%E7%A8%8B.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>说明：Reactor通过select监听事件，根据监听到的事件类型分发给acceptor或handler</li>
<li>缺点：无法充分利用CPU。</li>
<li>应用：Redis中使用的方案。</li>
</ul>
<p><em>单Reactor多线程</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E5%8D%95Reactor%E5%A4%9A%E7%BA%BF%E7%A8%8B.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>说明：普通多线程模型中每个线程需要负责一个socket，Reactor中多线程只是完成业务处理，Socket的维护都交给了Reactor对象。</li>
<li>缺点：单Reactor容易称为并发时的性能瓶颈。</li>
</ul>
<p><em>多Reactor多进程</em><br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/%E4%B8%BB%E4%BB%8EReactor%E5%A4%9A%E7%BA%BF%E7%A8%8B.webp" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>说明：不再由一个Reactor对象负责所有Socket管理，而是由主Reactor负责监听Accptor事件，子Reactor负责业务处理。</li>
<li>应用：Netty中使用的方案。</li>
</ul>
<h3 id="Proactor模型"><a href="#Proactor模型" class="headerlink" title="Proactor模型"></a>Proactor模型</h3><p>异步网络模式。使用了异步I&#x2F;O技术，但在Linux下目前不完善，Window支持较好。<br><img src="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/Proactor.webp" srcset="/img/loading.gif" lazyload></p>
<h3 id="网络模式对比"><a href="#网络模式对比" class="headerlink" title="网络模式对比"></a>网络模式对比</h3><ul>
<li>Reactor 是非阻塞同步网络模式，感知的是就绪可读写事件。</li>
<li>Proactor 是异步网络模式， 感知的是已完成的读写事件。</li>
</ul>
<h1 id="八、性能指标"><a href="#八、性能指标" class="headerlink" title="八、性能指标"></a>八、性能指标</h1><p><em>性能指标</em></p>
<ul>
<li>带宽：b&#x2F;s</li>
<li>延时：s</li>
<li>吞吐率：B&#x2F;s</li>
<li>PPS：包&#x2F;s</li>
</ul>
<p><em>查看配置</em></p>
<ul>
<li>网络配置：<code>ifconfig</code>、<code>ip</code></li>
<li>socket信息：<code>netstat</code>、<code>ss</code></li>
<li>吞吐率和PPS：<code>sar -n</code></li>
<li>连通性和延时：<code>ping</code></li>
</ul>
<p><em>查看日志</em><br>原则：尽量不要使用<code>cat</code>，应该使用<code>less</code>查看。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/" class="category-chain-item">概念整理</a>
  
  
    <span>></span>
    
  <a href="/categories/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="category-chain-item">操作系统</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">#操作系统</a>
      
        <a href="/tags/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/">#概念整理</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>操作系统复习</div>
      <div>http://example.com/2023/03/16/概念整理/操作系统/操作系统复习/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Jin</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年3月16日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/16/%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A0/%E8%AE%A1%E7%BD%91%E5%A4%8D%E4%B9%A0/" title="计网复习">
                        <span class="hidden-mobile">计网复习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="twikoo"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/twikoo/1.6.7/twikoo.all.min.js', function() {
        var options = Object.assign(
          {"envId":"https://twikoo-api-lime.vercel.app/","region":"ap-shanghai","path":"window.location.pathname"},
          {
            el: '#twikoo',
            path: 'window.location.pathname',
            onCommentLoaded: function() {
              var imgSelector = '#twikoo .tk-content img:not(.tk-owo-emotion)';
              Fluid.plugins.imageCaption(imgSelector);
              Fluid.plugins.fancyBox(imgSelector);
            }
          }
        )
        twikoo.init(options)
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/fluid-extention.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
